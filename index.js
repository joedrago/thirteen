(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
var Animation,calcSign;calcSign=function(r){return 0===r?0:r<0?-1:1},Animation=function(){function r(r){var t,s;this.speed=r.speed,this.req={},this.cur={};for(t in r)s=r[t],"speed"!==t&&(this.req[t]=s,this.cur[t]=s)}return r.prototype.warp=function(){if(null!=this.cur.r&&(this.cur.r=this.req.r),null!=this.cur.s&&(this.cur.s=this.req.s),null!=this.cur.x&&null!=this.cur.y)return this.cur.x=this.req.x,this.cur.y=this.req.y},r.prototype.animating=function(){return null!=this.cur.r&&this.req.r!==this.cur.r||(null!=this.cur.s&&this.req.s!==this.cur.s||null!=this.cur.x&&null!=this.cur.y&&(this.req.x!==this.cur.x||this.req.y!==this.cur.y))},r.prototype.update=function(r){var t,s,i,h,u,c,e,n,l,q;if(n=!1,null!=this.cur.r&&this.req.r!==this.cur.r){for(n=!0,e=2*Math.PI,u=-1*e;this.req.r>=e;)this.req.r-=e;for(;this.req.r<=u;)this.req.r+=e;s=this.req.r-this.cur.r,t=Math.abs(s),c=calcSign(s),t>Math.PI&&(t=e-t,c*=-1),h=r*this.speed.r/1e3,t<h?this.cur.r=this.req.r:this.cur.r+=h*c}return null!=this.cur.s&&this.req.s!==this.cur.s&&(n=!0,i=this.req.s-this.cur.s,t=Math.abs(i),c=calcSign(i),h=r*this.speed.s/1e3,t<h?this.cur.s=this.req.s:this.cur.s+=h*c),null!=this.cur.x&&null!=this.cur.y&&(this.req.x===this.cur.x&&this.req.y===this.cur.y||(n=!0,l=this.req.x-this.cur.x,q=this.req.y-this.cur.y,t=Math.sqrt(l*l+q*q),h=r*this.speed.t/1e3,t<h?(this.cur.x=this.req.x,this.cur.y=this.req.y):(this.cur.x+=l/t*h,this.cur.y+=q/t*h))),n},r}(),module.exports=Animation;
},{}],2:[function(require,module,exports){
var Animation,Button;Animation=require("./Animation"),Button=function(){function t(t,i,e,s,n,r,h){this.game=t,this.spriteNames=i,this.font=e,this.textHeight=s,this.x=n,this.y=r,this.cb=h,this.anim=new Animation({speed:{s:3},s:0}),this.color={r:1,g:1,b:1,a:0}}return t.prototype.update=function(t){return this.anim.update(t)},t.prototype.render=function(){var t;return this.color.a=this.anim.cur.s,this.game.spriteRenderer.render(this.spriteNames[0],this.x,this.y,0,1.5*this.textHeight,0,.5,.5,this.game.colors.white,function(t){return function(){return t.anim.cur.s=1,t.anim.req.s=0,t.cb(!0)}}(this)),this.game.spriteRenderer.render(this.spriteNames[1],this.x,this.y,0,1.5*this.textHeight,0,.5,.5,this.color),t=this.cb(!1),this.game.fontRenderer.render(this.font,this.textHeight,t,this.x,this.y,.5,.5,this.game.colors.buttontext)},t}(),module.exports=Button;
},{"./Animation":1}],3:[function(require,module,exports){
var FontRenderer,fontmetrics,hexToRgb;fontmetrics=require("./fontmetrics"),hexToRgb=function(e,t){var r;return r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r?{r:parseInt(r[1],16)/255,g:parseInt(r[2],16)/255,b:parseInt(r[3],16)/255,a:t}:null},FontRenderer=function(){function e(e){this.game=e,this.white={r:1,g:1,b:1,a:1}}return e.prototype.size=function(e,t,r){var n,h,i,o,a,f,s,g,c,d,u;if(g=fontmetrics[e]){for(c=t/g.height,u=0,d=g.height*c,a=!1,o=f=0,s=r.length;f<s;o=++f)if(n=r[o],"`"===n&&(a=!a),!a){if(h=n.charCodeAt(0),!(i=g.glyphs[h]))continue;u+=i.xadvance*c}return{w:u,h:d}}},e.prototype.render=function(e,t,r,n,h,i,o,a,f){var s,g,c,d,u,p,x,l,m,b,v,y,w,R,I,A,C,F,T,q,z;if(I=fontmetrics[e]){for(C=t/I.height,z=0,q=I.height*C,F=!1,m=b=0,w=r.length;b<w;m=++b)c=r[m],"`"===c&&(F=!F),F||(d=c.charCodeAt(0),(l=I.glyphs[d])&&(z+=l.xadvance*C));for(s=-1*i*z,g=-1*o*q,p=n,T=a||this.white,x=T,u=-1,A=[],m=v=0,R=r.length;v<R;m=++v)c=r[m],"`"===c&&(-1===u?u=m+1:(y=m-u,x=y?hexToRgb(r.substr(u,m-u),T.a):T,u=-1)),-1===u&&(d=c.charCodeAt(0),(l=I.glyphs[d])&&(this.game.drawImage(e,l.x,l.y,l.width,l.height,p+l.xoffset*C+s,h+l.yoffset*C+g,l.width*C,l.height*C,0,0,0,x.r,x.g,x.b,x.a,f),A.push(p+=l.xadvance*C)));return A}},e}(),module.exports=FontRenderer;
},{"./fontmetrics":10}],4:[function(require,module,exports){
var Animation,BUILD_TIMESTAMP,Button,FontRenderer,Game,Hand,Menu,OK,Pile,RenderMode,SpriteRenderer,Thirteen,achievementsList,aiCharacters,ref;Animation=require("./Animation"),Button=require("./Button"),FontRenderer=require("./FontRenderer"),SpriteRenderer=require("./SpriteRenderer"),Menu=require("./Menu"),Hand=require("./Hand"),Pile=require("./Pile"),ref=require("./Thirteen"),Thirteen=ref.Thirteen,OK=ref.OK,aiCharacters=ref.aiCharacters,achievementsList=ref.achievementsList,BUILD_TIMESTAMP="1.23",RenderMode={GAME:0,HOWTO:1,ACHIEVEMENTS:2,PAUSE:3,OPTIONS:4},Game=function(){function e(e,t,r){this.native=e,this.width=t,this.height=r,this.version=BUILD_TIMESTAMP,this.log("Game constructed: "+this.width+"x"+this.height),this.fontRenderer=new FontRenderer(this),this.spriteRenderer=new SpriteRenderer(this),this.font="darkforest",this.zones=[],this.nextAITick=1e3,this.center={x:this.width/2,y:this.height/2},this.aaHeight=9*this.width/16,this.log("height: "+this.height+". height if screen was 16:9 (aspect adjusted): "+this.aaHeight),this.pauseButtonSize=this.aaHeight/12,this.colors={arrow:{r:1,g:1,b:1,a:1},arrowclose:{r:1,g:.5,b:0,a:.3},background:{r:0,g:.2,b:0,a:1},bid:{r:0,g:.6,b:0,a:1},black:{r:0,g:0,b:0,a:1},buttontext:{r:1,g:1,b:1,a:1},game_over:{r:1,g:.5,b:0,a:1},gold:{r:1,g:1,b:0,a:1},hand_any:{r:0,g:0,b:.2,a:1},hand_pick:{r:0,g:.1,b:0,a:1},hand_drag:{r:.4,g:0,b:0,a:1},hand_push:{r:.2,g:0,b:.2,a:1},lightgray:{r:.5,g:.5,b:.5,a:1},logbg:{r:.1,g:0,b:0,a:1},logcolor:{r:.5,g:.5,b:.5,a:1},mainmenu:{r:.1,g:.1,b:.1,a:1},orange:{r:1,g:.5,b:0,a:1},overlay:{r:0,g:0,b:0,a:.6},pausemenu:{r:.1,g:0,b:.1,a:1},optionmenu:{r:0,g:.1,b:.1,a:1},pile:{r:.4,g:.2,b:0,a:1},play_again:{r:0,g:0,b:0,a:.6},red:{r:1,g:0,b:0,a:1},white:{r:1,g:1,b:1,a:1},ach_bg:{r:.1,g:.1,b:.1,a:1},ach_header:{r:1,g:.5,b:0,a:1},ach_title:{r:1,g:1,b:1,a:1},ach_desc:{r:.7,g:.7,b:.7,a:1},ach_button:{r:.7,g:.7,b:.3,a:1},transparent:{r:1,g:1,b:1,a:0}},this.textures={cards:0,darkforest:1,chars:2,how1:3,how2:4,how3:5},this.thirteen=null,this.lastErr="",this.renderMode=RenderMode.GAME,this.renderCommands=[],this.achievementFanfare=null,this.achievementsPage=0,this.howtoPage=0,this.optionMenus={speeds:[{text:"AI Speed: Slow",speed:2e3},{text:"AI Speed: Medium",speed:1e3},{text:"AI Speed: Fast",speed:500},{text:"AI Speed: Ultra",speed:250}],sorts:[{text:"Sort Order: Normal"},{text:"Sort Order: Reverse"}],autopasses:[{text:"AutoPass: Disabled"},{text:"AutoPass: Full"},{text:"AutoPass: Limited"}]},this.options={speedIndex:1,sortIndex:0,sound:!0,autopassIndex:2,pushSorting:!1,givingUp:!0,passBreak:!0},this.pauseMenu=new Menu(this,"Paused","solid",this.colors.pausemenu,[function(e){return function(t){return t&&(e.renderMode=RenderMode.GAME),"Resume Game"}}(this),function(e){return function(t){return t&&(e.renderMode=RenderMode.OPTIONS),"Options"}}(this),function(e){return function(t){return t&&(e.renderMode=RenderMode.ACHIEVEMENTS),"Achievements"}}(this),function(e){return function(t){return t&&(e.renderMode=RenderMode.HOWTO),"How To Play"}}(this),function(e){return function(t){return t&&(e.newGame(!0),e.renderMode=RenderMode.GAME),"New Money Game"}}(this),function(e){return function(t){return t&&(e.newGame(!1),e.renderMode=RenderMode.GAME),"New Game"}}(this)]),this.optionMenu=new Menu(this,"Options","solid",this.colors.optionmenu,[function(e){return function(t){return t&&(e.options.speedIndex=(e.options.speedIndex+1)%e.optionMenus.speeds.length),e.optionMenus.speeds[e.options.speedIndex].text}}(this),function(e){return function(t){return t&&(e.options.autopassIndex=(e.options.autopassIndex+1)%e.optionMenus.autopasses.length),e.optionMenus.autopasses[e.options.autopassIndex].text}}(this),function(e){return function(t){return t&&(e.options.sortIndex=(e.options.sortIndex+1)%e.optionMenus.sorts.length),e.optionMenus.sorts[e.options.sortIndex].text}}(this),function(e){return function(t){return t&&(e.options.givingUp=!e.options.givingUp),e.options.givingUp?"Giving Up: Enabled":"Giving Up: Disabled"}}(this),function(e){return function(t){return t&&(e.options.passBreak=!e.options.passBreak),e.options.passBreak?"Pass Breaks: Enabled":"Pass Breaks: Disabled"}}(this),function(e){return function(t){return t&&(e.options.pushSorting=!e.options.pushSorting),e.options.pushSorting?"Push Sorting: Enabled":"Push Sorting: Disabled"}}(this),function(e){return function(t){return t&&(e.renderMode=RenderMode.PAUSE),"Back"}}(this)]),this.thirteen=new Thirteen(this,{}),this.log("player 0's hand: "+JSON.stringify(this.thirteen.players[0].hand)),this.prepareGame()}return e.prototype.log=function(e){return this.native.log(e)},e.prototype.load=function(e){var t,r,n,i;this.log("(CS) loading state");try{n=JSON.parse(e)}catch(t){return void this.log("load failed to parse state: "+e)}if(n.options){r=n.options;for(t in r)i=r[t],this.options[t]=i}if(n.thirteen)return this.log("recreating game from savedata"),this.thirteen=new Thirteen(this,{state:n.thirteen}),this.prepareGame()},e.prototype.save=function(){var e;return e={options:this.options},null!=this.thirteen&&(this.thirteen.updatePlayerHand(this.hand.cards),e.thirteen=this.thirteen.save()),JSON.stringify(e)},e.prototype.aiTickRate=function(){return this.optionMenus.speeds[this.options.speedIndex].speed},e.prototype.newGame=function(e){return this.thirteen.newGame(e),this.prepareGame()},e.prototype.prepareGame=function(){return this.hand=new Hand(this),this.pile=new Pile(this,this.hand),this.hand.set(this.thirteen.players[0].hand),this.lastErr=""},e.prototype.touchDown=function(e,t){return this.checkZones(e,t)},e.prototype.touchMove=function(e,t){if(null!==this.thirteen)return this.hand.move(e,t)},e.prototype.touchUp=function(e,t){if(null!==this.thirteen)return this.hand.up(e,t)},e.prototype.prettyErrorTable={gameOver:"The game is over.",invalidPlay:"Not a valid play.",mustBreakOrPass:"You passed already, so 2-breaker or pass.",mustPass:"You must pass.",mustThrow3S:"You must use the 3È in your play.",notYourTurn:"It is not your turn.",throwAnything:"You have control, throw anything.",tooLowPlay:"This play is not stronger than the current play.",wrongPlay:"This play does not match the current play."},e.prototype.prettyError=function(){return this.prettyErrorTable[this.lastErr]||this.lastErr},e.prototype.calcHeadline=function(){var e,t;return null===this.thirteen?"":(t=this.thirteen.headline(),e="",this.lastErr.length>0&&this.lastErr!==OK&&(e="  `ffffff`ERROR: `ff0000`"+this.prettyError(),t+=e),t)},e.prototype.gameOverText=function(){var e,t,r,n;return n=this.thirteen.winner(),e=n.name+" wins!",r="Try Again...","Player"===n.name?(e="You win!",r=1===this.thirteen.lastStreak?"A new streak!":this.thirteen.lastStreak+" in a row!"):r=0===this.thirteen.lastStreak?"Try again...":"Streak ended: "+this.thirteen.lastStreak+" wins",this.thirteen.someoneGaveUp()&&(t=this.thirteen.players[0].money-Thirteen.STARTING_MONEY,r=t>0?"Game Over: You won $"+t:t<0?"Game Over: You lost $"+-1*t:"Game Over: You broke even!"),[e,r]},e.prototype.pass=function(){return this.lastErr=this.thirteen.pass({id:1})},e.prototype.play=function(e){var t,r,n,i,s;for(console.log("(game) playing cards",e),this.thirteen.updatePlayerHand(this.hand.cards),i=[],r=0,n=e.length;r<n;r++)t=e[r],i.push(t.card);if(s=this.thirteen.play({id:1,cards:i}),this.lastErr=s,s===OK)return this.hand.set(this.thirteen.players[0].hand),this.pile.hint(e)},e.prototype.playPicked=function(){var e;if(this.hand.picking())return e=this.hand.selectedCards(),0===e.length?this.pass():this.play(e)},e.prototype.update=function(e){var t;return this.zones.length=0,t=!1,this.updateGame(e)&&(t=!0),t},e.prototype.updateGame=function(e){var t;return null!==this.thirteen&&(t=!1,this.pile.update(e)&&(t=!0),this.pile.readyForNextTrick()&&(this.nextAITick-=e,this.nextAITick<=0&&(this.nextAITick=this.aiTickRate(),this.thirteen.aiTick()&&(t=!0))),this.hand.update(e)&&(t=!0),this.pile.set(this.thirteen.throwID,this.thirteen.pile,this.thirteen.pileWho),this.pauseMenu.update(e)&&(t=!0),this.optionMenu.update(e)&&(t=!0),null!==this.achievementFanfare&&(this.achievementFanfare.time+=e,this.achievementFanfare.time>5e3&&(this.achievementFanfare=null),t=!0),null===this.achievementFanfare&&this.thirteen.fanfares.length>0&&(this.achievementFanfare={title:this.thirteen.fanfares.shift(),time:0}),t)},e.prototype.render=function(){switch(this.renderCommands.length=0,this.renderMode){case RenderMode.HOWTO:this.renderHowto();break;case RenderMode.ACHIEVEMENTS:this.renderAchievements();break;case RenderMode.OPTIONS:this.renderOptions();break;case RenderMode.PAUSE:this.renderPause();break;default:this.renderGame()}return this.renderCommands},e.prototype.renderPause=function(){return this.pauseMenu.render()},e.prototype.renderOptions=function(){return this.optionMenu.render()},e.prototype.renderHowto=function(){var e,t,r,n,i,s;return t=3,r="how"+(this.howtoPage+1),this.log("rendering "+r),this.spriteRenderer.render(r,0,0,this.width,this.aaHeight,0,0,0,this.colors.white,function(e){return function(){return e.renderMode=RenderMode.PAUSE}}(this)),e="Page "+(this.howtoPage+1)+" / 3",i=this.height/20,s=i/4,this.fontRenderer.render(this.font,i,e,this.width-s,this.height-s,1,1,this.colors.ach_header),n=.1*this.width,this.fontRenderer.render(this.font,i,"[ Next ]",this.width-s,s,1,0,this.colors.ach_button),this.spriteRenderer.render("solid",this.width-n,0,n,n,0,0,0,this.colors.transparent,function(e){return function(){return e.howtoPage=(e.howtoPage+1)%t}}(this))},e.prototype.debug=function(){return console.log("debug ach"),console.log(this.thirteen.ach)},e.prototype.renderAchievements=function(){var e,t,r,n,i,s,h,o,a,d,u,c,p,l,f,g,m,y,w,v,M,R,b,P,x,A;for(this.spriteRenderer.render("solid",0,0,this.width,this.height,0,0,0,this.colors.ach_bg,function(e){return function(){return e.renderMode=RenderMode.PAUSE}}(this)),n=achievementsList.length,s=Math.ceil(n/14),i=0,t=c=0,l=achievementsList.length;c<l;t=++c)e=achievementsList[t],this.thirteen.ach.earned[e.id]&&(i+=1);for(b="Achievements - "+i+" / "+n+" Complete - Page "+(this.achievementsPage+1)+" of "+s,M=this.height/20,R=M/2,this.fontRenderer.render(this.font,M,b,this.center.x,R,.5,.5,this.colors.ach_header),s>1&&(f=.1*this.width,this.fontRenderer.render(this.font,M,"[ Next ]",this.width,R,1,.5,this.colors.ach_button),this.spriteRenderer.render("solid",this.width-f,0,f,f,0,0,0,this.colors.transparent,function(e){return function(){return e.achievementsPage=(e.achievementsPage+1)%s}}(this))),u=this.width/15,P=M,x=this.width/120,A=P,M=this.height/22,h=this.height/30,d=2*M,v=14*this.achievementsPage,o=v+14,o>achievementsList.length-1&&(o=achievementsList.length-1),w=[],t=p=m=v,y=o;m<=y?p<=y:p>=y;t=m<=y?++p:--p)r=t-v,e=achievementsList[t],a="star_off",this.thirteen.ach.earned[e.id]&&(a="star_on"),this.spriteRenderer.render(a,x,A,d,d,0,0,0,this.colors.white),this.fontRenderer.render(this.font,M,e.title,x+u,A,0,0,this.colors.ach_title),this.fontRenderer.render(this.font,h,e.description[0],x+u,A+M,0,0,this.colors.ach_desc),null!=e.progress?(g=e.progress(this.thirteen.ach),this.fontRenderer.render(this.font,h,g,x+u,A+M+h,0,0,this.colors.ach_desc)):e.description.length>1&&this.fontRenderer.render(this.font,h,e.description[1],x+u,A+M+h,0,0,this.colors.ach_desc),6===r?(A=P,w.push(x+=this.width/2)):w.push(A+=3*M);return w},e.prototype.renderAIHand=function(e,t,r,n){var i,s,h,o,a,d;for(d=e.sort(function(e,t){return e-t}),a=[],i=s=0,h=d.length;s<h;i=++s)o=d[i],a.push(this.hand.renderCard(o,t+i*n,r,0,.7,0));return a},e.prototype.renderGame=function(){var e,t,r,n,i,s,h,o,a,d,u,c,p,l,f,g,m,y,w,v,M,R,b,P,x,A,I,S,T,E,k;for(this.spriteRenderer.render("solid",0,0,this.width,this.height,0,0,0,this.colors.background),I=this.aaHeight/25,S=I/5,i=this.aaHeight/5,a=I,d=this.thirteen.gameOver()&&this.pile.resting(),P=this.thirteen.log,f=g=0,m=P.length;g<m;f=++g)y=P[f],this.fontRenderer.render(this.font,I,y,0,(f+1.5)*(I+S),0,0,this.colors.logcolor);switch(t=[this.thirteen.players[1],this.thirteen.players[2],this.thirteen.players[3]],s=i/2,this.charCeiling=.6*this.height,e=.015*this.width,null!==t[0]&&(d&&this.renderAIHand(t[0].hand,.2*this.width,.62*this.height,e),n=aiCharacters[t[0].charID],h=this.spriteRenderer.calcWidth(n.sprite,i),function(e){return function(t){return e.spriteRenderer.render(t.sprite,s,e.charCeiling,0,i,0,0,1,e.colors.white,function(){return e.thirteen.punch(t)})}}(this)(n),this.renderCount(t[0],this.thirteen.money,d,t[0].index===this.thirteen.turn,a,s+h/2,this.charCeiling-S,.5,0)),null!==t[1]&&(d&&this.renderAIHand(t[1].hand,.6*this.width,.18*this.height,e),n=aiCharacters[t[1].charID],function(e){return function(t){return e.spriteRenderer.render(t.sprite,e.center.x,0,0,i,0,.5,0,e.colors.white,function(){return e.thirteen.punch(t)})}}(this)(n),this.renderCount(t[1],this.thirteen.money,d,t[1].index===this.thirteen.turn,a,this.center.x,i,.5,0)),null!==t[2]&&(d&&this.renderAIHand(t[2].hand,.7*this.width,.62*this.height,e),n=aiCharacters[t[2].charID],h=this.spriteRenderer.calcWidth(n.sprite,i),function(e){return function(t){return e.spriteRenderer.render(t.sprite,e.width-s,e.charCeiling,0,i,0,1,1,e.colors.white,function(){return e.thirteen.punch(t)})}}(this)(n),this.renderCount(t[2],this.thirteen.money,d,t[2].index===this.thirteen.turn,a,this.width-(s+h/2),this.charCeiling-S,.5,0)),p=.27*this.height,r=null,this.hand.mode){case Hand.PICKING:l=this.colors.hand_pick,0!==this.thirteen.turn||!this.thirteen.everyonePassed()&&null!==this.thirteen.currentPlay||(l=this.colors.hand_any,r=0===this.thirteen.pile.length?"Anything (3È)":"Anything");break;case Hand.PUSHING:l=this.colors.hand_push,r="Sorting";break;default:r="Dragging",l=this.colors.hand_drag}this.spriteRenderer.render("solid",0,this.height,this.width,p,0,0,1,l,function(e){return function(){return e.hand.cycleMode()}}(this)),M=.4*this.height,R="pile",this.thirteen.turn>=0&&this.thirteen.turn<=3&&(R+=this.thirteen.turn),this.spriteRenderer.render(R,this.width/2,this.height/2,M,M,0,.5,.5,this.colors.white,function(e){return function(){return e.playPicked()}}(this)),this.pile.render(),this.hand.render(),d&&(w=this.gameOverText(),u=this.aaHeight/8,c=this.center.y,w.length>1&&(c-=u>>1),this.fontRenderer.render(this.font,u,w[0],this.center.x,c,.5,.5,this.colors.game_over),w.length>1&&(c+=u,this.fontRenderer.render(this.font,u,w[1],this.center.x,c,.5,.5,this.colors.game_over)),b="Play Again",this.thirteen.someoneGaveUp()&&(b="New Money Game"),this.spriteRenderer.render("solid",0,this.height,this.width,p,0,0,1,this.colors.play_again,function(e){return function(){return e.thirteen.someoneGaveUp()?e.thirteen.newGame(!0,!0):e.thirteen.deal(),e.prepareGame()}}(this)),x=this.aaHeight/12,A=x/8,this.fontRenderer.render(this.font,x,b,A+this.center.x,A+(this.height-.5*p),.5,1,this.colors.black),this.fontRenderer.render(this.font,x,b,this.center.x,this.height-.5*p,.5,1,this.colors.gold)),this.renderCount(this.thirteen.players[0],this.thirteen.money,d,0===this.thirteen.turn,a,this.center.x,this.height,.5,1),this.fontRenderer.render(this.font,I,this.calcHeadline(),0,0,0,0,this.colors.lightgray),this.spriteRenderer.render("pause",this.width,0,0,this.pauseButtonSize,0,1,0,this.colors.white,function(e){return function(){return e.renderMode=RenderMode.PAUSE}}(this)),null!==r&&this.fontRenderer.render(this.font,I,r,.02*this.width,this.height-p,0,0,this.colors.white),null!==this.achievementFanfare&&(v=this.achievementFanfare.time<1e3?this.achievementFanfare.time/1e3:this.achievementFanfare.time>4e3?1-(this.achievementFanfare.time-4e3)/1e3:1,o={r:1,g:1,b:1,a:v},T=.6*this.width,k=0,E=T+.06*this.width,this.spriteRenderer.render("au",T,k,0,this.height/10,0,0,0,o,function(e){return function(){return e.achievementFanfare=null,e.renderMode=RenderMode.ACHIEVEMENTS}}(this)),this.fontRenderer.render(this.font,I,"Achievement Earned",E,k,0,0,o),this.fontRenderer.render(this.font,I,this.achievementFanfare.title,E,k+I,0,0,o))},e.prototype.renderCount=function(e,t,r,n,i,s,h,o,a){var d,u,c,p,l,f,g,m,y,w;return f=n?"`ff7700`":"",m=" "+f+e.name+"``",t&&(null==e.money&&(e.money=0),m+=": $ `aaffaa`"+e.money),m+=" ",u=e.hand.length,r||0===u?t?(w="4th",1===e.place?w="1st":2===e.place?w="2nd":3===e.place&&(w="3rd"),p=" `ffaaff`"+w+"`` Place "):p=1===e.place?" `ffffaa`Winner`` ":" `ffaaff`Loser`` ":p=" `ffff33`"+u+"`` left ",g=this.fontRenderer.size(this.font,i,m),c=this.fontRenderer.size(this.font,i,p),g.w>c.w?c.w=g.w:g.w=c.w,y=h,l=h,d=c.h,d*=2,a>0?y-=i:l+=i,this.spriteRenderer.render("solid",s,h,c.w,d,0,o,a,this.colors.overlay),this.fontRenderer.render(this.font,i,m,s,y,o,a,this.colors.white),this.fontRenderer.render(this.font,i,p,s,l,o,a,this.colors.white)},e.prototype.drawImage=function(e,t,r,n,i,s,h,o,a,d,u,c,p,l,f,g,m){var y,w,v;if(this.renderCommands.push(this.textures[e],t,r,n,i,s,h,o,a,d,u,c,p,l,f,g),null!=m)return y=-1*u*o,w=-1*c*a,v={cx:s,cy:h,rot:-1*d,l:y,t:w,r:y+o,b:w+a,cb:m},this.zones.push(v)},e.prototype.checkZones=function(e,t){var r,n,i,s,h,o,a;for(s=this.zones,r=s.length-1;r>=0;r+=-1)if(a=s[r],h=e-a.cx,o=t-a.cy,n=h*Math.cos(a.rot)-o*Math.sin(a.rot),i=h*Math.sin(a.rot)+o*Math.cos(a.rot),!(n<a.l||n>a.r||i<a.t||i>a.b))return a.cb(e,t),!0;return!1},e}(),module.exports=Game;
},{"./Animation":1,"./Button":2,"./FontRenderer":3,"./Hand":5,"./Menu":6,"./Pile":7,"./SpriteRenderer":8,"./Thirteen":9}],5:[function(require,module,exports){
var Animation,CARD_HAND_CURVE_DIST_FACTOR,CARD_HOLDING_ROT_ORDER,CARD_HOLDING_ROT_PLAY,CARD_IMAGE_ADV_X,CARD_IMAGE_ADV_Y,CARD_IMAGE_H,CARD_IMAGE_OFF_X,CARD_IMAGE_OFF_Y,CARD_IMAGE_W,CARD_PLAY_CEILING,CARD_RENDER_SCALE,Hand,Highlight,NO_CARD,calcDistance,calcDistanceSquared,findAngle;Animation=require("./Animation"),CARD_IMAGE_W=120,CARD_IMAGE_H=162,CARD_IMAGE_OFF_X=4,CARD_IMAGE_OFF_Y=4,CARD_IMAGE_ADV_X=CARD_IMAGE_W,CARD_IMAGE_ADV_Y=CARD_IMAGE_H,CARD_RENDER_SCALE=.35,CARD_HAND_CURVE_DIST_FACTOR=3.5,CARD_HOLDING_ROT_ORDER=Math.PI/12,CARD_HOLDING_ROT_PLAY=-1*Math.PI/12,CARD_PLAY_CEILING=.6,NO_CARD=-1,Highlight={NONE:-1,UNSELECTED:0,SELECTED:1,PILE:2},findAngle=function(t,i,r){var h,a,e;return h=Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2),a=Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2),e=Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2),Math.acos((h+a-e)/Math.sqrt(4*h*a))},calcDistance=function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))},calcDistanceSquared=function(t,i,r,h){return Math.pow(r-t,2)+Math.pow(h-i,2)},Hand=function(){function t(i){var r,h,a,e;this.game=i,this.cards=[],this.anims={},this.positionCache={},this.mode=t.PICKING,this.picked=[],this.pickPaint=!1,this.dragIndexStart=NO_CARD,this.dragIndexCurrent=NO_CARD,this.dragX=0,this.dragY=0,this.cardSpeed={r:2*Math.PI,s:2.5,t:2*this.game.width},this.playCeiling=CARD_PLAY_CEILING*this.game.height,this.cardHeight=Math.floor(this.game.height*CARD_RENDER_SCALE),this.cardWidth=Math.floor(this.cardHeight*CARD_IMAGE_W/CARD_IMAGE_H),this.cardHalfHeight=this.cardHeight>>1,this.cardHalfWidth=this.cardWidth>>1,r=this.cardWidth/2,h=this.cardHeight/50,a={x:r,y:h+this.game.height},e={x:this.game.width-r,y:h+this.game.height},this.handCenter={x:this.game.width/2,y:h+this.game.height+CARD_HAND_CURVE_DIST_FACTOR*this.game.height},this.handAngle=findAngle(a,this.handCenter,e),this.handDistance=calcDistance(a,this.handCenter),this.handAngleAdvanceMax=this.handAngle/7,this.game.log("Hand distance "+this.handDistance+", angle "+this.handAngle+" (screen height "+this.game.height+")")}return t.CARD_IMAGE_W=CARD_IMAGE_W,t.CARD_IMAGE_H=CARD_IMAGE_H,t.CARD_IMAGE_OFF_X=CARD_IMAGE_OFF_X,t.CARD_IMAGE_OFF_Y=CARD_IMAGE_OFF_Y,t.CARD_IMAGE_ADV_X=CARD_IMAGE_ADV_X,t.CARD_IMAGE_ADV_Y=CARD_IMAGE_ADV_Y,t.CARD_RENDER_SCALE=CARD_RENDER_SCALE,t.Highlight=Highlight,t.PICKING=0,t.DRAGGING=1,t.PUSHING=2,t.prototype.picking=function(){return this.mode===t.PICKING},t.prototype.cycleMode=function(){if(this.mode=function(){switch(this.mode){case t.PICKING:return t.DRAGGING;case t.DRAGGING:return this.game.options.pushSorting?t.PUSHING:t.PICKING;case t.PUSHING:return t.PICKING}}.call(this),this.mode===t.PICKING)return this.selectNone()},t.prototype.selectNone=function(){this.picked=new Array(this.cards.length).fill(!1)},t.prototype.set=function(i){return this.cards=i.slice(0),this.mode===t.PICKING&&this.selectNone(),this.syncAnims(),this.warp()},t.prototype.syncAnims=function(){var t,i,r,h,a,e,n,s,d;for(s={},e=this.cards,i=0,h=e.length;i<h;i++)t=e[i],s[t]++,this.anims[t]||(this.anims[t]=new Animation({speed:this.cardSpeed,x:0,y:0,r:0}));d=[],n=this.anims;for(t in n)n[t],s.hasOwnProperty(t)||d.push(t);for(r=0,a=d.length;r<a;r++)t=d[r],delete this.anims[t];return this.updatePositions()},t.prototype.calcDrawnHand=function(){var t,i,r,h,a,e;for(i=[],e=this.cards,r=h=0,a=e.length;h<a;r=++h)t=e[r],r!==this.dragIndexStart&&i.push(t);return this.dragIndexCurrent!==NO_CARD&&i.splice(this.dragIndexCurrent,0,this.cards[this.dragIndexStart]),i},t.prototype.wantsToPlayDraggedCard=function(){return this.dragIndexStart!==NO_CARD&&this.dragY<this.playCeiling},t.prototype.updatePositions=function(){var t,i,r,h,a,e,n,s,d,o,c,A,_;for(a=this.calcDrawnHand(),_=this.wantsToPlayDraggedCard(),r=CARD_HOLDING_ROT_ORDER,o=a.length,_&&(r=CARD_HOLDING_ROT_PLAY,o--),c=this.calcPositions(o),h=0,A=[],e=n=0,s=a.length;n<s;e=++n)i=a[e],t=this.anims[i],e===this.dragIndexCurrent?(t.req.x=this.dragX,t.req.y=this.dragY,t.req.r=r,_?A.push(void 0):A.push(h++)):(d=c[h],t.req.x=d.x,t.req.y=d.y,t.req.r=d.r,A.push(h++));return A},t.prototype.warp=function(){var t,i,r,h;r=this.anims,h=[];for(i in r)t=r[i],h.push(t.warp());return h},t.prototype.reorder=function(){var t,i,r,h,a,e,n,s;if(this.dragIndexStart!==NO_CARD&&!(this.cards.length<2)){for(s=this.calcPositions(this.cards.length),i=0,t=this.game.width*this.game.height,h=a=0,e=s.length;a<e;h=++a)n=s[h],r=calcDistanceSquared(n.x,n.y,this.dragX,this.dragY),t>r&&(t=r,i=h);return this.dragIndexCurrent=i}},t.prototype.selectedCards=function(){var i,r,h,a,e,n,s;if(this.mode!==t.PICKING)return[];for(h=[],s=this.cards,a=e=0,n=s.length;e<n;a=++e)r=s[a],this.picked[a]&&(i=this.anims[r],h.push({card:r,x:i.cur.x,y:i.cur.y,r:i.cur.r,index:a}));return h},t.prototype.down=function(i,r,h){var a;return this.dragX=i,this.dragY=r,this.up(this.dragX,this.dragY),this.mode===t.PICKING?(this.picked[h]=!this.picked[h],void(this.pickPaint=this.picked[h])):this.mode===t.PUSHING?void(h<this.cards.length&&(a=this.cards[h],this.cards.splice(h,1),this.cards.push(a),this.updatePositions())):(this.game.log("picking up card index "+h),this.dragIndexStart=h,this.dragIndexCurrent=h,this.updatePositions())},t.prototype.move=function(t,i){if(this.dragX=t,this.dragY=i,this.dragIndexStart!==NO_CARD)return this.reorder(),this.updatePositions()},t.prototype.up=function(t,i){var r,h,a;if(this.dragX=t,this.dragY=i,this.dragIndexStart!==NO_CARD)return this.reorder(),this.wantsToPlayDraggedCard()?(this.game.log("trying to play a "+this.cards[this.dragIndexStart]+" from index "+this.dragIndexStart),a=this.dragIndexStart,h=this.cards[a],r=this.anims[h],this.dragIndexStart=NO_CARD,this.dragIndexCurrent=NO_CARD,this.game.play([{card:h,x:r.cur.x,y:r.cur.y,r:r.cur.r,index:a}])):(this.game.log("trying to reorder "+this.cards[this.dragIndexStart]+" into index "+this.dragIndexCurrent),this.cards=this.calcDrawnHand()),this.dragIndexStart=NO_CARD,this.dragIndexCurrent=NO_CARD,this.updatePositions()},t.prototype.update=function(t){var i,r,h,a;a=!1,h=this.anims;for(r in h)i=h[r],i.update(t)&&(a=!0);return a},t.prototype.render=function(){var i,r,h,a,e,n,s;if(0!==this.cards.length){for(r=this.calcDrawnHand(),n=[],h=a=0,e=r.length;a<e;h=++a)(s=r[h])!==NO_CARD&&(i=this.anims[s],n.push(function(i){return function(r,h){var a;return a=i.mode===t.PICKING?i.picked[h]?Highlight.SELECTED:Highlight.UNSELECTED:i.wantsToPlayDraggedCard()?h===i.dragIndexCurrent?Highlight.SELECTED:Highlight.UNSELECTED:Highlight.NONE,i.renderCard(s,r.cur.x,r.cur.y,r.cur.r,1,a,function(t,r){return i.down(t,r,h)})}}(this)(i,h)));return n}},t.prototype.renderCard=function(t,i,r,h,a,e,n){var s,d,o;return h||(h=0),d=Math.floor(t/4),o=Math.floor(t%4),s=function(){switch(e){case Highlight.NONE:case Highlight.UNSELECTED:return[1,1,1];case Highlight.SELECTED:return[.5,.5,.9];case Highlight.PILE:return[.6,.6,.6]}}(),this.game.drawImage("cards",CARD_IMAGE_OFF_X+CARD_IMAGE_ADV_X*d,CARD_IMAGE_OFF_Y+CARD_IMAGE_ADV_Y*o,CARD_IMAGE_W,CARD_IMAGE_H,i,r,this.cardWidth*a,this.cardHeight*a,h,.5,.5,s[0],s[1],s[2],1,n)},t.prototype.calcPositions=function(t){var i,r,h,a,e,n,s,d,o;if(this.positionCache.hasOwnProperty(t))return this.positionCache[t];if(0===t)return[];for(i=this.handAngle/t,i>this.handAngleAdvanceMax&&(i=this.handAngleAdvanceMax),h=i*t,r=this.handAngle-h,a=this.handAngle/2*-1,a+=r/2,a+=i/2,n=[],e=0,s=t;0<=s?e<s:e>s;0<=s?++e:--e)d=this.handCenter.x-Math.cos(Math.PI/2+a)*this.handDistance,o=this.handCenter.y-Math.sin(Math.PI/2+a)*this.handDistance,a+=i,n.push({x:d,y:o,r:a-i});return this.positionCache[t]=n,n},t}(),module.exports=Hand;
},{"./Animation":1}],6:[function(require,module,exports){
var Button,Menu;Button=require("./Button"),Menu=function(){function t(t,e,h,i,n){var s,r,o,a,g,u,m,c;for(this.game=t,this.title=e,this.background=h,this.color=i,this.actions=n,this.buttons=[],this.buttonNames=["button0","button1"],o=this.game.height/15,this.buttonStartY=this.game.height/5,c=(this.game.height-this.buttonStartY)/(this.actions.length+1),a=this.buttonStartY+c,m=this.actions,g=0,u=m.length;g<u;g++)s=m[g],r=new Button(this.game,this.buttonNames,this.game.font,o,this.game.center.x,a,s),this.buttons.push(r),a+=c}return t.prototype.update=function(t){var e,h,i,n,s;for(s=!1,n=this.buttons,h=0,i=n.length;h<i;h++)e=n[h],e.update(t)&&(s=!0);return s},t.prototype.render=function(){var t,e,h,i,n,s,r;for(this.game.spriteRenderer.render(this.background,0,0,this.game.width,this.game.height,0,0,0,this.color),this.game.fontRenderer.render(this.game.font,this.game.height/25,"Build: "+this.game.version,0,this.game.height,0,1,this.game.colors.lightgray),s=this.game.height/8,r=this.buttonStartY>>1,this.game.fontRenderer.render(this.game.font,s,this.title,this.game.center.x,r,.5,.5,this.game.colors.white),i=this.buttons,n=[],e=0,h=i.length;e<h;e++)t=i[e],n.push(t.render());return n},t}(),module.exports=Menu;
},{"./Button":2}],7:[function(require,module,exports){
var Animation,Hand,Pile,SETTLE_MS;Animation=require("./Animation"),Hand=require("./Hand"),SETTLE_MS=250,Pile=function(){function t(t,i){var s,e,r,n,h;this.game=t,this.hand=i,this.playID=-1,this.plays=[],this.anims={},this.settleTimer=0,this.thrownColor={r:1,g:1,b:0,a:1},this.scale=.6,r=.2,this.playCardSpacing=.1,s=this.game.center.x,e=this.game.center.y,n=this.hand.cardWidth*r*this.scale,h=this.hand.cardHalfHeight*r*this.scale,this.playLocations=[{x:s,y:e+h},{x:s-n,y:e},{x:s,y:e-h},{x:s+n,y:e}],this.throwLocations=[{x:s,y:this.game.height},{x:0,y:e+h},{x:s,y:0},{x:this.game.width,y:e+h}]}return t.prototype.set=function(t,i,s){return this.playID!==t&&(this.playID=t,this.plays.push({cards:i.slice(0),who:s}),this.settleTimer=SETTLE_MS),this.syncAnims()},t.prototype.poke=function(){return this.settleTimer=SETTLE_MS},t.prototype.hint=function(t){var i,s,e,r;for(r=[],s=0,e=t.length;s<e;s++)i=t[s],r.push(this.anims[i.card]=new Animation({speed:this.hand.cardSpeed,x:i.x,y:i.y,r:i.r,s:1}));return r},t.prototype.syncAnims=function(){var t,i,s,e,r,n,h,a,o,p,l,c,u,y,d,m,f;for(d={},p=this.throwLocations,c=this.plays,i=0,n=c.length;i<n;i++)for(l=c[i],u=l.cards,s=e=0,h=u.length;e<h;s=++e)t=u[s],d[t]++,this.anims[t]||(f=l.who,o=p[f],this.anims[t]=new Animation({speed:this.hand.cardSpeed,x:o.x,y:o.y,r:-1*Math.PI/4,s:this.scale}));m=[],y=this.anims;for(t in y)y[t],d.hasOwnProperty(t)||m.push(t);for(r=0,a=m.length;r<a;r++)t=m[r],delete this.anims[t];return this.updatePositions()},t.prototype.updatePositions=function(){var t,i,s,e,r,n,h,a,o,p,l;for(n=this.playLocations,o=this.plays,p=[],a=i=0,e=o.length;i<e;a=++i)h=o[a],p.push(function(){var i,e,o,p;for(o=h.cards,p=[],s=i=0,e=o.length;i<e;s=++i)l=o[s],t=this.anims[l],r=h.who,t.req.x=n[r].x+s*this.hand.cardWidth*this.playCardSpacing,t.req.y=n[r].y,t.req.r=.2*Math.cos(a/.1),p.push(t.req.s=this.scale);return p}.call(this));return p},t.prototype.readyForNextTrick=function(){return this.resting()},t.prototype.update=function(t){var i,s,e,r;r=!1,this.settleTimer>0&&(r=!0,this.settleTimer-=t,this.settleTimer<0&&(this.settleTimer=0)),e=this.anims;for(s in e)i=e[s],i.update(t)&&(r=!0);return r},t.prototype.resting=function(){var t,i,s;s=this.anims;for(i in s)if(t=s[i],t.animating())return!1;return!(this.settleTimer>0)},t.prototype.render=function(){var t,i,s,e,r,n,h,a,o,p;for(a=this.plays,o=[],h=s=0,r=a.length;s<r;h=++s)n=a[h],i=Hand.Highlight.PILE,h===this.plays.length-1&&(i=Hand.Highlight.NONE),o.push(function(){var s,r,h,a;for(h=n.cards,a=[],e=s=0,r=h.length;s<r;e=++s)p=h[e],t=this.anims[p],a.push(this.hand.renderCard(p,t.cur.x,t.cur.y,t.cur.r,t.cur.s,i));return a}.call(this));return o},t}(),module.exports=Pile;
},{"./Animation":1,"./Hand":5}],8:[function(require,module,exports){
var SpriteRenderer;SpriteRenderer=function(){function e(e){this.game=e,this.sprites={solid:{texture:"chars",x:55,y:723,w:10,h:10},pause:{texture:"chars",x:602,y:707,w:122,h:125},button0:{texture:"chars",x:140,y:777,w:422,h:65},button1:{texture:"chars",x:140,y:698,w:422,h:65},plus0:{texture:"chars",x:745,y:664,w:116,h:118},plus1:{texture:"chars",x:745,y:820,w:116,h:118},minus0:{texture:"chars",x:895,y:664,w:116,h:118},minus1:{texture:"chars",x:895,y:820,w:116,h:118},arrowL:{texture:"chars",x:33,y:858,w:204,h:156},arrowR:{texture:"chars",x:239,y:852,w:208,h:155},pile:{texture:"chars",x:13,y:883,w:128,h:128},pile0:{texture:"chars",x:145,y:883,w:128,h:128},pile1:{texture:"chars",x:277,y:883,w:128,h:128},pile2:{texture:"chars",x:409,y:883,w:128,h:128},pile3:{texture:"chars",x:541,y:883,w:128,h:128},mainmenu:{texture:"mainmenu",x:0,y:0,w:1280,h:720},pausemenu:{texture:"pausemenu",x:0,y:0,w:1280,h:720},how1:{texture:"how1",x:0,y:0,w:1920,h:1080},how2:{texture:"how2",x:0,y:0,w:1920,h:1080},how3:{texture:"how3",x:0,y:0,w:1920,h:1080},au:{texture:"chars",x:540,y:1079,w:400,h:80},star_on:{texture:"chars",x:38,y:1066,w:190,h:190},star_off:{texture:"chars",x:250,y:1066,w:190,h:190},mario:{texture:"chars",x:20,y:0,w:151,h:308},luigi:{texture:"chars",x:171,y:0,w:151,h:308},peach:{texture:"chars",x:335,y:0,w:164,h:308},daisy:{texture:"chars",x:504,y:0,w:164,h:308},yoshi:{texture:"chars",x:668,y:0,w:180,h:308},toad:{texture:"chars",x:849,y:0,w:157,h:308},bowser:{texture:"chars",x:11,y:322,w:151,h:308},bowserjr:{texture:"chars",x:225,y:322,w:144,h:308},koopa:{texture:"chars",x:372,y:322,w:128,h:308},rosalina:{texture:"chars",x:500,y:322,w:173,h:308},shyguy:{texture:"chars",x:691,y:322,w:154,h:308},toadette:{texture:"chars",x:847,y:322,w:158,h:308}}}return e.prototype.calcWidth=function(e,t){var r;return r=this.sprites[e],r?t*r.w/r.h:1},e.prototype.render=function(e,t,r,h,x,u,s,a,w,y){var c;(c=this.sprites[e])&&(0===h&&0===x?(h=c.x,x=c.y):0===h?h=x*c.w/c.h:0===x&&(x=h*c.h/c.w),this.game.drawImage(c.texture,c.x,c.y,c.w,c.h,t,r,h,x,u,s,a,w.r,w.g,w.b,w.a,y))},e}(),module.exports=SpriteRenderer;
},{}],9:[function(require,module,exports){
var Card,GlyphSuitName,MAX_LOG_LINES,MIN_PLAYERS,OK,STARTING_MONEY,ShortSuitName,ShuffledDeck,Suit,SuitName,Thirteen,achievementsList,achievementsMap,aiCharacterList,aiCharacters,cardsToString,character,debug,debug2,e,l,len1,len2,m,playToCardCount,playToString,playTypeToString,randomCharacter;for(MIN_PLAYERS=3,MAX_LOG_LINES=6,OK="OK",STARTING_MONEY=25,Suit={NONE:-1,SPADES:0,CLUBS:1,DIAMONDS:2,HEARTS:3},SuitName=["Spades","Clubs","Diamonds","Hearts"],ShortSuitName=["S","C","D","H"],GlyphSuitName=["È","É","Ê","Ë"],aiCharacterList=[{id:"mario",name:"Mario",sprite:"mario",brain:"normal"},{id:"luigi",name:"Luigi",sprite:"luigi",brain:"normal"},{id:"peach",name:"Peach",sprite:"peach",brain:"normal"},{id:"daisy",name:"Daisy",sprite:"daisy",brain:"normal"},{id:"yoshi",name:"Yoshi",sprite:"yoshi",brain:"normal"},{id:"toad",name:"Toad",sprite:"toad",brain:"normal"},{id:"bowser",name:"Bowser",sprite:"bowser",brain:"normal"},{id:"bowserjr",name:"Bowser Jr",sprite:"bowserjr",brain:"normal"},{id:"koopa",name:"Koopa",sprite:"koopa",brain:"normal"},{id:"rosalina",name:"Rosalina",sprite:"rosalina",brain:"normal"},{id:"shyguy",name:"Shyguy",sprite:"shyguy",brain:"normal"},{id:"toadette",name:"Toadette",sprite:"toadette",brain:"normal"}],aiCharacters={},l=0,len1=aiCharacterList.length;l<len1;l++)character=aiCharacterList[l],aiCharacters[character.id]=character;for(randomCharacter=function(){var t;return t=Math.floor(Math.random()*aiCharacterList.length),aiCharacterList[t]},Card=function(){function t(t){this.raw=t,this.suit=Math.floor(this.raw%4),this.value=Math.floor(this.raw/4),this.valueName=function(){switch(this.value){case 8:return"J";case 9:return"Q";case 10:return"K";case 11:return"A";case 12:return"2";default:return String(this.value+3)}}.call(this),this.name=this.valueName+ShortSuitName[this.suit]}return t.prototype.glyphedName=function(){return this.valueName+GlyphSuitName[this.suit]},t}(),cardsToString=function(t){var e,a,r,i,n;for(a=[],i=0,r=t.length;i<r;i++)n=t[i],e=new Card(n),a.push(e.name);return"[ "+a.join(",")+" ]"},playTypeToString=function(t){var e;return(e=t.match(/^rop(\d+)/))?"Run of "+e[1]+" Pairs":(e=t.match(/^run(\d+)/))?"Run of "+e[1]:(e=t.match(/^kind(\d+)/))?"1"===e[1]?"Single":"2"===e[1]?"Pair":"3"===e[1]?"Trips":"Quads":t},playToString=function(t){var e;return e=new Card(t.high),playTypeToString(t.type)+" - "+e.glyphedName()},playToCardCount=function(t){var e;return(e=t.type.match(/^rop(\d+)/))?2*parseInt(e[1]):(e=t.type.match(/^run(\d+)/))?parseInt(e[1]):(e=t.type.match(/^kind(\d+)/))?parseInt(e[1]):1},ShuffledDeck=function(){function t(){var t,e,a;for(this.cards=[0],t=a=1;a<52;t=++a)e=Math.floor(Math.random()*t),this.cards.push(this.cards[e]),this.cards[e]=t}return t}(),achievementsList=[{id:"veteran",title:"I've Seen Some Things",description:["Play 50 Hands."],progress:function(t){return t.state.totalGames>=50?"Total Played: `aaffaa`"+t.state.totalGames+"`` Games":"Progress: "+t.state.totalGames+" / 50"}},{id:"tryhard",title:"Tryhard",description:["Earn a 5 game win streak."],progress:function(t){var e,a;return e=t.state.bestStreak,null==e&&(e=0),e>=5?"Best Streak: `aaffaa`"+e+"`` Wins":(a="",e>1&&(a="s"),"Best Streak: "+e+" Win"+a)}},{id:"breaker",title:"Spring Break",description:["Break a 2."]},{id:"keepitlow",title:"Keep It Low, Boys",description:["Play a Single 2 on top of a Single 3."]},{id:"suited",title:"Doesn't Even Matter",description:["Throw a suited run."]},{id:"tony",title:"The Tony",description:["Throw a run of 7 or more cards, and then lose."]},{id:"sampler",title:"Sampler Platter",description:["In a single hand: play at least one Single,","one Pair, one Trips, and one Run."]},{id:"tragedy",title:"Tragedy",description:["Begin the game by throwing a two breaker involving","the 3 of Spades."]},{id:"indomitable",title:"Indomitable",description:["Throw a run ending in the Ace of Hearts."]},{id:"rekt",title:"Get Rekt",description:["Win while all opponents still have 10 or more cards."]},{id:"late",title:"Fashionably Late",description:["Pass until all 4 2s are thrown, and then win."]},{id:"pairs",title:"Pairing Up",description:["Throw 5 pairs in a single round."]},{id:"yourself",title:"You Played Yourself",description:["Beat your own play."]},{id:"thirteen",title:"Thirteen",description:["Earn 13 achievements."]},{id:"veteran2",title:"Old Timer",description:["Play 1000 Hands."],progress:function(t){return t.state.totalGames>=1e3?"Total Played: `aaffaa`"+t.state.totalGames+"`` Games":"Progress: "+t.state.totalGames+" / 1000"}},{id:"skilled",title:"Skilled",description:["Win 50 Hands."],progress:function(t){return t.state.totalWins>=50?"Total Wins: `aaffaa`"+t.state.totalWins+"`` Wins":"Progress: "+t.state.totalWins+" / 50"}},{id:"consolationprize",title:"Consolation Prize",description:["Lose 10 Hands spectacularly (10+ cards left)."],progress:function(t){return t.state.spectacularLosses>=10?"Total: `aaffaa`"+t.state.spectacularLosses+"`` Bad Beats":"Progress: "+t.state.spectacularLosses+" / 10"}},{id:"bling",title:"Bling Bling",description:["Bankrupt another player in a money game when","you are ahead by $15 dollars or more ($"+(STARTING_MONEY+15)+" total)."]},{id:"keepthechange",title:"Keep the Change",description:["Win a hand by throwing a single 3 last."]},{id:"dragracing",title:"Drag Racing",description:["Throw a play with the 3 of spades which makes","all opponents pass."]},{id:"handicapped",title:"Handicapped",description:["Win with a hand without any twos."]},{id:"solitaire",title:"Solitaire",description:["Throw a run of 5 or more cards with alternating","red and black colors."]},{id:"ballet",title:"Ballet",description:["Throw a pair of twos (two twos)."]},{id:"palindrome",title:"Palindrome",description:["Throw a run of pairs... but in a reversible way."]},{id:"pagercode",title:"Pager Code",description:["The secret password is BATHES. Don't tell anyone."]},{id:"beast",title:"Number of the Beast",description:["Throw a 3-of-a-kind of 6s."]},{id:"thirteen2",title:"Thirteen 2: Electric Boogaloo",description:["Earn 13 x 2 (26) achievements."]},{id:"toad",title:"Nobody Likes You, Toad",description:["Punch Toad in the face."]}],achievementsMap={},m=0,len2=achievementsList.length;m<len2;m++)e=achievementsList[m],achievementsMap[e.id]=e;Thirteen=function(){function t(t,e){var a,r;if(this.game=t,e)if(e.state){r=e.state;for(a in r)r[a],e.state.hasOwnProperty(a)&&(this[a]=e.state[a]);this.initAchievements()}else this.newGame(e.money)}return t.STARTING_MONEY=STARTING_MONEY,t.prototype.initAchievements=function(){var t,e,a,r,i;return null==this.ach&&(this.ach={}),null==(t=this.ach).earned&&(t.earned={}),null==(e=this.ach).state&&(e.state={}),null==(a=this.ach.state).totalGames&&(a.totalGames=0),null==(r=this.ach.state).totalWins&&(r.totalWins=0),null==(i=this.ach.state).spectacularLosses&&(i.spectacularLosses=0),this.fanfares=[]},t.prototype.deal=function(t){var e,a,r,i,n,s,h,o,l,u;for(a=new ShuffledDeck,u=this.players,o=n=0,i=u.length;n<i;o=++n){for(h=u[o],this.game.log("dealing 13 cards to player "+o),h.place=0,h.hand=[],s=0;s<13;++s)l=a.cards.shift(),0===l&&(this.turn=o),h.hand.push(l);0===this.game.options.sortIndex||h.ai?h.hand.sort(function(t,e){return t-e}):h.hand.sort(function(t,e){return e-t})}return this.initAchievements(),this.ach.state.threwSingle=!1,this.ach.state.threwPair=!1,this.ach.state.threwTrips=!1,this.ach.state.threwRun=!1,this.ach.state.threwRun7=!1,this.ach.state.twosSeen=0,this.ach.state.fashionablyLate=!1,this.ach.state.pairsThrown=0,null==(e=this.ach.state).bestStreak&&(e.bestStreak=0),this.ach.state.handicapped=!this.handHas2(this.players[0].hand),this.pile=[],this.pileWho=-1,this.throwID=0,this.currentPlay=null,this.unpassAll(),r="",this.money&&(r=" (for money)"),this.output("Hand dealt"+r+", "+this.players[this.turn].name+" plays first"),OK},t.prototype.newGame=function(e,a){var r;for(null==e&&(e=!1),null==a&&(a=!1),this.log=[],a?(null==this.streak&&(this.streak=0),null==this.lastStreak&&(this.lastStreak=0)):(this.streak=0,this.lastStreak=0),this.money=!1,e&&(this.money=!0),console.log("for money: "+this.money),this.players=[{id:1,name:"Player",index:0,pass:!1,money:t.STARTING_MONEY}],r=1;r<4;++r)this.addAI();return this.deal()},t.prototype.save=function(){var t,e,a,r,i;for(r="log players turn pile pileWho throwID currentPlay streak lastStreak ach money".split(" "),i={},e=0,t=r.length;e<t;e++)a=r[e],i[a]=this[a];return i},t.prototype.output=function(t){var e;for(this.log.push(t),e=[];this.log.length>MAX_LOG_LINES;)e.push(this.log.shift());return e},t.prototype.headline=function(){var t,e,a,r;return this.gameOver()?"Game Over":(a=0===this.pile.length?"throw Anything with the 3È":this.currentPlay?"beat "+playToString(this.currentPlay):"throw Anything",t=this.currentPlayer(),r=t.ai?"b0b000":"ff7700",e="`"+r+"`"+t.name+"`ffffff` to "+a,this.everyonePassed()&&(e+=" (or throw anything)"),e)},t.prototype.canThrowAnything=function(){return 0===this.pile.length||(!this.currentPlay||!!this.everyonePassed())},t.prototype.findPlayer=function(t){var e,a,r,i;for(i=this.players,a=0,e=i.length;a<e;a++)if(r=i[a],r.id===t)return r},t.prototype.currentPlayer=function(){return this.players[this.turn]},t.prototype.findPlace=function(t){var e,a,r,i;for(i=this.players,a=0,e=i.length;a<e;a++){if(r=i[a],4===t&&0===r.place)return r;if(r.place===t)return r}},t.prototype.payout=function(){var t,e,a,r;if(t=this.findPlace(1),e=this.findPlace(2),a=this.findPlace(3),r=this.findPlace(4),!(t&&e&&a&&r))return void this.output("error with payouts!");this.output(r.name+" pays $2 to "+t.name),this.output(a.name+" pays $1 to "+e.name),t.money+=2,e.money+=1,a.money+=-1,r.money+=-2},t.prototype.punch=function(t){if(console.log("thirteen: punching "+t.id),"toad"===t.id)return this.earn("toad")},t.prototype.entireTablePassed=function(){var t,e,a,r,i;for(i=this.players,r=e=0,t=i.length;e<t;r=++e)if(a=i[r],0===a.place&&!a.pass)return!1;return!0},t.prototype.everyonePassed=function(){var t,e,a,r,i;for(i=this.players,r=e=0,t=i.length;e<t;r=++e)if(a=i[r],(0===a.place||this.pileWho===r)&&r!==this.turn&&!a.pass)return!1;return!0},t.prototype.playerAfter=function(t){for(;;)if(t=(t+1)%this.players.length,0===this.players[t].place)return t;return 0},t.prototype.addPlayer=function(t){return t.ai||(t.ai=!1),this.players.push(t),t.index=this.players.length-1,this.output(t.name+" joins the game")},t.prototype.namePresent=function(t){var e,a,r,i;for(i=this.players,a=0,e=i.length;a<e;a++)if(r=i[a],r.name===t)return!0;return!1},t.prototype.addAI=function(){for(var e;;)if(character=randomCharacter(),!this.namePresent(character.name))break;return e={charID:character.id,name:character.name,id:"ai"+String(this.players.length),pass:!1,ai:!0,money:t.STARTING_MONEY},this.addPlayer(e),this.game.log("added AI player"),OK},t.prototype.updatePlayerHand=function(t){return this.players[0].hand=t.slice(0)},t.prototype.winner=function(){var t,e,a,r,i;for(i=this.players,t=a=0,e=i.length;a<e;t=++a)if(r=i[t],1===r.place)return r;return null},t.prototype.someoneGaveUp=function(){var t,e,a,r;if(!this.money)return!1;if(!this.game.options.givingUp)return!1;for(r=this.players,e=0,t=r.length;e<t;e++)if(a=r[e],a.money<=0)return!0;return!1},t.prototype.gameOver=function(){var t;return t=this.nextPlace(),this.money?t>3:t>1},t.prototype.hasCard=function(t,e){var a,r;for(r=0,a=t.length;r<a;r++)if(t[r]===e)return!0;return!1},t.prototype.hasCards=function(t,e){var a,r,i;for(r=0,a=e.length;r<a;r++)if(i=e[r],!this.hasCard(t,i))return!1;return!0},t.prototype.removeCards=function(t,e){var a,r,i,n,s,h,o,l;for(h=[],s=0,i=t.length;s<i;s++){for(a=t[s],r=!0,o=0,n=e.length;o<n;o++)if(l=e[o],a===l){r=!1;break}r&&h.push(a)}return h},t.prototype.classify=function(t){var e,a,r,i,n,s,h,o,l,u,p,c,d,y;if(r=t.map(function(t){return new Card(t)}),r=r.sort(function(t,e){return t.raw-e.raw}),s=r[r.length-1].raw,r.length>=6&&r.length%2==0){for(i=!0,a=u=0,h=r.length;u<h;a=++u)if(e=r[a],0!==a){if(12===e.value){i=!1;break}if(a%2==1){if(e.value!==r[a-1].value){i=!1;break}}else if(e.value!==r[a-1].value+1){i=!1;break}}if(i)return{type:"rop"+Math.floor(r.length/2),high:s}}if(r.length>=3){for(n=!0,a=p=0,o=r.length;p<o;a=++p)if(e=r[a],0!==a){if(12===e.value){n=!1;break}if(e.value!==r[a-1].value+1){n=!1;break}}if(n)return{type:"run"+r.length,high:s}}for(d=r[0].value,c=0,l=r.length;c<l;c++)if(e=r[c],e.value!==d)return null;return y="kind"+r.length,{type:y,high:s}},t.prototype.handHas3S=function(t){var e,a;for(a=0,e=t.length;a<e;a++)if(0===t[a])return!0;return!1},t.prototype.handHas2=function(t){var e,a;for(a=0,e=t.length;a<e;a++)if(t[a]>=48)return!0;return!1},t.prototype.handIsReversible=function(t){var e,a,r,i,n,s;if(0===t.length)return!1;for(a=t.map(function(t){return new Card(t)}),r=a.map(function(t){return t.value}),r=r.reverse(),i=s=0,n=a.length;s<n;i=++s)if(e=a[i],e.value!==r[i])return!1;return!0},t.prototype.handIsBATHES=function(t){var e,a,r,i,n,s;if(6!==t.length)return!1;for(a=t.map(function(t){return new Card(t)}),r=[5,3,4,1,0,2],i=s=0,n=a.length;s<n;i=++s)if(e=a[i],e.value!==r[i])return!1;return!0},t.prototype.cardIsRed=function(t){return t.suit===Suit.DIAMONDS||t.suit===Suit.HEARTS},t.prototype.handAlternatesRedAndBlack=function(t){var e,a,r,i,n;for(a=t.map(function(t){return new Card(t)}),a=a.sort(function(t,e){return t.raw-e.raw}),n=this.cardIsRed(a[0]),i=0,r=a.length;i<r;i++){if(e=a[i],n!==this.cardIsRed(e))return!1;n=!n}return!0},t.prototype.nextPlace=function(){var t,e,a,r,i;for(t=0,i=this.players,a=0,e=i.length;a<e;a++)r=i[a],null==r.place&&(r.place=0),t<r.place&&(t=r.place);return t+1},t.prototype.splitPlayType=function(t){var e;return(e=t.match(/^([^0-9]+)(\d+)/))?[e[1],parseInt(e[2])]:[t,1]},t.prototype.hasPlay=function(t,e){var a,r,i,n,s,h,o,l,u,p,c,d,y,f,g,m,v;if(playToCardCount(t)>e.length)return!1;if(2===this.game.options.autopassIndex)return!0;switch(n=[],c={},m=this.splitPlayType(t.type),m[0]){case"rop":n=this.aiCalcRops(e,c,m[1]);break;case"run":n=this.aiCalcRuns(e,c,!1,m[1]);break;case"kind":n=this.alCalcKinds(e,c,!0)}for(null==c.kind1&&(c.kind1=[]),l=0,s=n.length;l<s;l++)i=n[l],c.kind1.push([i]);if(null!=c[t.type]&&c[t.type].length>0)for(y=c[t.type],u=0,h=y.length;u<h;u++)if(p=y[u],this.highestCard(p)>t.high)return!0;if("kind"===m[0])for(a=d=f=m[1];f<=4?d<=4:d>=4;a=f<=4?++d:--d)if(r="kind"+a,null!=c[r]&&c[r].length>0)for(g=c[r],v=0,o=g.length;v<o;v++)if(p=g[v],this.highestCard(p)>t.high)return!0;return!1},t.prototype.canPass=function(t){var e;return this.gameOver()?"gameOver":(e=this.currentPlayer(),t.id!==e.id?"notYourTurn":0===this.pile.length?"mustThrow3S":this.everyonePassed()?"throwAnything":OK)},t.prototype.canPlay=function(t,e,a){var r;return this.gameOver()?"gameOver":(r=this.currentPlayer(),t.id!==r.id?"notYourTurn":null===e?"invalidPlay":0!==this.pile.length||a?(r=this.currentPlayer(),r.pass?this.game.options.passBreak&&this.currentPlay&&this.canBeBroken(this.currentPlay)?this.isBreakerType(e.type)?OK:"mustBreakOrPass":"mustPass":null===this.currentPlay?OK:this.everyonePassed()?OK:this.canBeBroken(this.currentPlay)&&this.isBreakerType(e.type)?OK:e.type!==this.currentPlay.type?"wrongPlay":e.high<this.currentPlay.high?"tooLowPlay":OK):"mustThrow3S")},t.prototype.play=function(e){var a,r,i,n,s,h,o,l,u,p,c,d,y,f,g,m,v,P,w,k,S,T;if(u=this.classify(e.cards),console.log("incomingPlay",u),console.log("someone calling play",e),(S=this.canPlay(e,u,this.handHas3S(e.cards)))!==OK)return S;for(o=!1,f=!0,T="throws:",this.currentPlay?this.canBeBroken(this.currentPlay)&&this.isBreakerType(u.type)?(this.unpassAll(),T="breaks 2:",o=!0,f=!1):u.type!==this.currentPlay.type||u.high<this.currentPlay.high?(this.unpassAll(),T="throws new:"):f=!1:T="begins:",null==(i=this.ach.state).twosSeen&&(i.twosSeen=0),null==(n=this.ach.state).pairsThrown&&(n.pairsThrown=0),w=e.cards,y=0,p=w.length;y<p;y++)w[y]>=48&&(this.ach.state.twosSeen+=1);if(4===this.ach.state.twosSeen&&13===this.players[0].hand.length&&(this.ach.state.fashionablyLate=!0),console.log("@ach.state.fashionablyLate "+this.ach.state.fashionablyLate),0===this.turn&&(this.everyonePassed()&&!f&&this.earn("yourself"),"kind2"===u.type&&(this.ach.state.pairsThrown+=1,this.ach.state.pairsThrown>=5&&this.earn("pairs")),o&&this.earn("breaker"),this.isBreakerType(u.type)&&0===this.pile.length&&this.earn("tragedy"),this.isRunType(u.type)&&this.isSuited(e.cards)&&this.earn("suited"),this.currentPlay&&"kind1"===this.currentPlay.type&&this.currentPlay.high<=3&&"kind1"===u.type&&u.high>=48&&this.earn("keepitlow"),this.isRunType(u.type)&&47===u.high&&this.earn("indomitable"),this.isBigRun(u,7)&&(console.log("threwRun7: true"),this.ach.state.threwRun7=!0),"kind1"===u.type&&(this.ach.state.threwSingle=!0),"kind2"===u.type&&(this.ach.state.threwPair=!0),"kind3"===u.type&&(this.ach.state.threwTrips=!0),u.type.match(/^run/)&&(this.ach.state.threwRun=!0),this.ach.state.threwSingle&&this.ach.state.threwPair&&this.ach.state.threwTrips&&this.ach.state.threwRun&&this.earn("sampler"),e.cards.length>=5&&this.handAlternatesRedAndBlack(e.cards)&&this.earn("solitaire"),"kind2"===u.type&&u.high>=48&&this.earn("ballet"),"kind3"===u.type&&u.high>=12&&u.high<=15&&this.earn("beast"),this.handIsBATHES(e.cards)&&this.earn("pagercode"),u.type.match(/rop/)&&this.handIsReversible(e.cards)&&this.earn("palindrome")),this.currentPlay=u,this.throwID+=1,l=this.currentPlayer(),l.hand=this.removeCards(l.hand,e.cards),this.output(l.name+" "+T+" "+playToString(u)),0===l.hand.length){if(l.place=this.nextPlace(),this.money){if(m="4th",1===l.place?m="1st":2===l.place?m="2nd":3===l.place&&(m="3rd"),this.output(l.name+" takes "+m+" place"),3===l.place&&(this.payout(),this.game.options.givingUp))for(k=this.players,g=0,c=k.length;g<c;g++)v=k[g],v.money<=0&&(this.output(v.name+" gives up"),this.players[0].money>=t.STARTING_MONEY+15&&this.earn("bling"))}else this.output(l.name+" wins!");1===l.place&&(0===this.turn?(this.streak+=1,this.lastStreak=this.streak):(this.lastStreak=this.streak,this.streak=0)),null==(s=this.ach.state).bestStreak&&(s.bestStreak=0),this.ach.state.bestStreak<this.lastStreak&&(this.ach.state.bestStreak=this.lastStreak),this.ach.state.bestStreak>=5&&this.earn("tryhard"),this.ach.state.totalGames+=1,this.ach.state.totalGames>=50&&this.earn("veteran"),this.ach.state.totalGames>=1e3&&this.earn("veteran2"),1===l.place&&(0===this.turn?(null==(h=this.ach.state).totalWins&&(h.totalWins=0),this.ach.state.totalWins+=1,this.ach.state.totalWins>=50&&this.earn("skilled"),this.players[1].hand.length>=10&&this.players[2].hand.length>=10&&this.players[3].hand.length>=10&&this.earn("rekt"),this.ach.state.fashionablyLate&&this.earn("late"),this.ach.state.handicapped&&this.earn("handicapped"),1===e.cards.length&&e.cards[0]<4&&this.earn("keepthechange")):(this.ach.state.threwRun7&&this.earn("tony"),this.players[0].hand.length>=10&&(this.ach.state.spectacularLosses+=1,this.ach.state.spectacularLosses>=10&&this.earn("consolationprize"))))}for(r=0,P=0,d=achievementsList.length;P<d;P++)a=achievementsList[P],this.ach.earned[a.id]&&(r+=1);return r>=13&&this.earn("thirteen"),r>=26&&this.earn("thirteen2"),this.pile=e.cards.slice(0),this.pileWho=this.turn,this.turn=this.playerAfter(this.turn),OK},t.prototype.unpassAll=function(){var t,e,a,r;for(r=this.players,e=0,t=r.length;e<t;e++)a=r[e],a.pass=!1},t.prototype.pass=function(t){var e,a;return(a=this.canPass(t))!==OK?a:(e=this.currentPlayer(),e.ai||!this.currentPlay||this.hasPlay(this.currentPlay,e.hand)?e.pass?this.output(e.name+" auto-passes"):this.output(e.name+" passes"):this.output(e.name+" auto-passes (no plays)"),e.pass=!0,this.turn=this.playerAfter(this.turn),this.game.pile.poke(),0===this.turn&&this.everyonePassed()&&this.handHas3S(this.pile)&&this.earn("dragracing"),OK)},t.prototype.aiPlay=function(t,e){return this.play({id:t.id,cards:e})},t.prototype.aiPass=function(t){return this.pass({id:t.id})},t.prototype.earn=function(t){var e;if(!this.ach.earned[t]&&null!=(e=achievementsMap[t]))return this.ach.earned[t]=!0,this.output("Earned: "+e.title),this.fanfares.push(e.title)},t.prototype.aiLog=function(t){var e;return e=this.currentPlayer(),!!e.ai&&(character=aiCharacters[e.charID],this.game.log("AI["+e.name+" "+character.brain+"]: hand:"+cardsToString(e.hand)+" pile:"+cardsToString(this.pile)+" "+t))},t.prototype.aiTick=function(){var t;if(this.gameOver())return!1;if(this.entireTablePassed()&&(this.turn=this.playerAfter(this.pileWho),this.unpassAll(),this.currentPlay=null,this.output("Whole table passes, control to "+this.players[this.turn].name)),t=this.currentPlayer(),!t.ai){if(0!==this.game.options.autopassIndex&&!this.canThrowAnything())if(this.currentPlay&&"kind1"===this.currentPlay.type&&this.currentPlay.high>=48&&this.hasBreaker(t.hand));else{if(this.currentPlay&&!this.hasPlay(this.currentPlay,t.hand))return this.aiLog("autopassing for player, no plays"),this.aiPass(t),!0;if(t.pass)return this.aiLog("autopassing for player"),this.aiPass(t),!0}return!1}return character=aiCharacters[t.charID],this.brains[character.brain].play.apply(this,[t,this.currentPlay,this.everyonePassed()])===OK},t.prototype.alCalcKinds=function(t,e,a){var r,i,n,s,h,o,l,u,p,c,d,y,f,g;for(null==a&&(a=!1),i=t.map(function(t){return new Card(t)}),i=i.sort(function(t,e){return t.raw-e.raw}),g=[],l=0;l<13;++l)g.push([]);for(u=0,s=i.length;u<s;u++)r=i[u],g[r.value].push(r);for(t=[],y=p=0,h=g.length;p<h;y=++p)if(f=g[y],f.length>1&&(a||y<12))n="kind"+f.length,null==e[n]&&(e[n]=[]),e[n].push(f.map(function(t){return t.raw}));else for(c=0,o=f.length;c<o;c++)d=f[c],t.push(d.raw);return t},t.prototype.aiFindRuns=function(t,e,a,r){var i,n,s,h,o,l,u,p,c,d,y,f,g,m,v,P,w,k,S,T,b,C,O,R,L,B,I,A,N;for(null==r&&(r=!1),b=[],s=t.map(function(t){return new Card(t)}),s=s.sort(function(t,e){return t.raw-e.raw}),L=[],d=0;d<13;++d)L.push([]);for(y=0,u=s.length;y<u;y++)n=s[y],L[n.value].push(n);for(r?(h=12-a,o=0,i=-1):(h=0,o=12-a,i=1),C=g=h,m=o,v=i;v>0?g<=m:g>=m;C=g+=v){for(T=!0,f=O=0,P=a;0<=P?O<P:O>P;f=0<=P?++O:--O)if(L[C+f].length<e){T=!1;break}if(T){for(S=[],f=B=0,w=a;0<=w?B<w:B>w;f=0<=w?++B:--B)for(I=0,k=e;0<=k?I<k:I>k;0<=k?++I:--I)S.push(L[C+f].pop().raw);b.push(S)}}for(l=[],A=0,p=L.length;A<p;A++)for(R=L[A],N=0,c=R.length;N<c;N++)n=R[N],l.push(n.raw);return[b,l]},t.prototype.aiCalcRuns=function(t,e,a,r){var i,n,s,h,o,l,u,p,c,d,y,f;for(null==r&&(r=null),null!==r?(l=!0,f=r,n=r,i=1):(l=!1,a?(f=3,n=12,i=1):(f=12,n=3,i=-1)),d=o=f,u=n,p=i;p>0?o<=u:o>=u;d=o+=p)c=this.aiFindRuns(t,1,d,l),y=c[0],h=c[1],y.length>0&&(s="run"+d,e[s]=y),t=h;return t},t.prototype.aiCalcRops=function(t,e,a){var r,i,n,s,h,o,l,u,p,c,d;for(null==a&&(a=null),null!==a?(h=!0,d=a,r=a):(h=!1,d=3,r=6),c=s=o=d,l=r;o<=l?s<=l:s>=l;c=o<=l?++s:--s)u=this.aiFindRuns(t,2,c,h),p=u[0],n=u[1],p.length>0&&(i="rop"+c,e[i]=p),t=n;return t},t.prototype.aiCalcPlays=function(t,e){var a,r;return null==e&&(e={}),r={},e.seesRops&&(t=this.aiCalcRops(t,r)),e.prefersRuns?(t=this.aiCalcRuns(t,r,e.smallRuns),t=this.alCalcKinds(t,r,e.match2s)):(t=this.alCalcKinds(t,r,e.match2s),t=this.aiCalcRuns(t,r,e.smallRuns)),a=t.map(function(t){return[t]}),a.length>0&&(r.kind1=a),r},t.prototype.numberOfSingles=function(t){var e,a,r,i;if(null==t.kind1)return 0;for(r=0,i=t.kind1,a=0,e=i.length;a<e;a++)i[a]<48&&(r+=1);return r},t.prototype.breakerPlays=function(t){return this.aiCalcPlays(t,{seesRops:!0,prefersRuns:!1})},t.prototype.isBreakerType=function(t){return!(!t.match(/^rop/)&&"kind4"!==t)},t.prototype.canBeBroken=function(t){var e;return"kind1"===t.type&&(e=new Card(t.high),12===e.value)},t.prototype.hasBreaker=function(t){var e,a,r;r=this.breakerPlays(t);for(e in r)if(a=r[e],this.isBreakerType(e)&&a.length>0)return!0;return!1},t.prototype.isRunType=function(t){return!!t.match(/^run/)},t.prototype.isSuited=function(t){var e,a,r,i,n;if(t.length<1)return!1;for(a=t.map(function(t){return new Card(t)}),n=a[0].suit,i=0,r=a.length;i<r;i++)if(e=a[i],e.suit!==n)return!1;return!0},t.prototype.isBigRun=function(t,e){var a;return!!((a=t.type.match(/^run(\d+)/))&&parseInt(a[1])>=e)},t.prototype.aiCalcBestPlays=function(t){var e,a,r,i,n,s,h;for(e=null,a=r=0;r<16;a=++r)h={smallRuns:1==(1&a),prefersRuns:2==(2&a),match2s:4==(4&a),seesRops:8==(8&a)},s=this.aiCalcPlays(t,h),null===e?e=s:(n=this.numberOfSingles(s),i=this.numberOfSingles(e),n<i?e=s:n===i&&0===Math.floor(2*Math.random())&&(e=s));return e},t.prototype.prettyPlays=function(t,e){var a,r,i,n,s,h,o,l,u,p,c,d,y,f,g,m,v;null==e&&(e=!1),p={};for(m in t)for(a=t[m],p[m]=[],h=0,i=a.length;h<i;h++){for(u=a[h],o=[],l=0,n=u.length;l<n;l++)d=u[l],r=new Card(d),o.push(r.name);p[m].push(o)}if(e){y="";for(v in p)if(g=p[v],y+="      * "+playTypeToString(v)+":\n","kind1"===v)y+="        * "+g.map(function(t){return t[0]}).join(",")+"\n";else for(c=0,s=g.length;c<s;c++)f=g[c],y+="        * "+f.join(",")+"\n";return y}return JSON.stringify(p)},t.prototype.highestCard=function(t){var e,a,r,i;for(e=0,r=0,a=t.length;r<a;r++)i=t[r],e<i&&(e=i);return e},t.prototype.findPlayWith3S=function(t){var e,a,r,i,n;for(i in t)for(n=t[i],a=0,e=n.length;a<e;a++)if(r=n[a],this.handHas3S(r))return r;return console.log("findPlayWith3S: something impossible is happening"),[]},t.prototype.brains={normal:{id:"normal",name:"Normal",play:function(t,e,a){var r,i,n,s,h,o,l,u,p,c,d,y,f,g;if(t.pass){if(this.game.options.passBreak&&this.canBeBroken(e)&&this.hasBreaker(t.hand)){r=this.breakerPlays(t.hand);for(l in r)if(c=r[l],(l.match(/^rop/)||"kind4"===l)&&c.length>0&&(this.aiLog("breaking 2"),this.aiPlay(t,c[0])===OK))return OK}return this.aiLog("already passed, going to keep passing"),this.aiPass(t)}if(d=this.aiCalcBestPlays(t.hand),this.aiLog("best plays: "+this.prettyPlays(d)),0===this.pile.length&&(o=this.findPlayWith3S(d),this.aiLog("Throwing my play with the 3S in it"),this.aiPlay(t,o)===OK))return OK;if(e&&!a){if(null!=d[e.type]&&d[e.type].length>0){for(f=d[e.type],s=0,i=f.length;s<i;s++)if(o=f[s],this.highestCard(o)>e.high&&this.aiPlay(t,o)===OK)return OK;return this.aiLog("I guess I can't actually beat this, passing"),this.aiPass(t)}return this.aiLog("I don't have that play, passing"),this.aiPass(t)}if(this.aiLog("I can do anything, throwing a random play"),p=Object.keys(d),u=Math.floor(Math.random()*p.length),this.aiPlay(t,d[p[u]][0])===OK)return OK;for(g=t.hand,h=0,n=g.length;h<n;h++)if((y=g[h])>e.high){if(this.aiLog("found smallest single ("+y+"), playing"),this.aiPlay(t,[y])===OK)return OK;break}return this.aiLog("nothing else to do, passing"),this.aiPass(t)}}},t}(),debug=function(){var t,e,a,r,i,n,s,h,o,l,u,p,c,d,y;for(d=new Thirteen,i=0,y=100,t=s=0,p=y;0<=p?s<p:s>p;t=0<=p?++s:--s){for(a=new ShuffledDeck,n=[],h=0;h<13;++h)u=a.cards.shift(),n.push(u);for(n.sort(function(t,e){return t-e}),console.log("------------------------------------------------------------------------"),console.log("Hand "+(t+1)+": "+cardsToString(n)),console.log(""),r=!1,e=l=0;l<16;e=++l)c={smallRuns:1==(1&e),prefersRuns:2==(2&e),match2s:4==(4&e),seesRops:8==(8&e)},o=d.aiCalcPlays(n,c),console.log("   * Strategy: "+JSON.stringify(c)),console.log(d.prettyPlays(o,!0)),o.kind1||(r=!0);r&&(i+=1)}return console.log("fullyPlayed: "+i+" / "+y)},debug2=function(){var t,e,a,r;return e={options:{autopassIndex:1}},r=new Thirteen(e),t={type:"run3",high:26},a=[10,11,15,19,23,27],console.log(r.hasPlay(t,a))},module.exports={Card:Card,Thirteen:Thirteen,OK:OK,aiCharacters:aiCharacters,achievementsList:achievementsList,achievementsMap:achievementsMap};
},{}],10:[function(require,module,exports){
module.exports={darkforest:{height:72,glyphs:{97:{x:8,y:8,width:34,height:42,xoffset:1,yoffset:31,xadvance:34},98:{x:8,y:58,width:35,height:52,xoffset:1,yoffset:20,xadvance:34},99:{x:50,y:8,width:35,height:42,xoffset:1,yoffset:31,xadvance:34},100:{x:8,y:118,width:35,height:52,xoffset:1,yoffset:20,xadvance:34},101:{x:8,y:178,width:35,height:42,xoffset:1,yoffset:31,xadvance:34},102:{x:8,y:228,width:35,height:42,xoffset:1,yoffset:31,xadvance:33},103:{x:8,y:278,width:36,height:42,xoffset:1,yoffset:31,xadvance:35},104:{x:8,y:328,width:35,height:42,xoffset:1,yoffset:31,xadvance:34},105:{x:8,y:378,width:12,height:42,xoffset:1,yoffset:31,xadvance:11},106:{x:8,y:428,width:35,height:41,xoffset:2,yoffset:31,xadvance:34},107:{x:28,y:378,width:35,height:41,xoffset:1,yoffset:31,xadvance:34},108:{x:51,y:328,width:34,height:41,xoffset:1,yoffset:31,xadvance:33},109:{x:51,y:427,width:38,height:42,xoffset:1,yoffset:31,xadvance:37},110:{x:71,y:377,width:35,height:42,xoffset:1,yoffset:31,xadvance:34},111:{x:97,y:427,width:35,height:41,xoffset:1,yoffset:31,xadvance:34},112:{x:51,y:58,width:35,height:42,xoffset:1,yoffset:31,xadvance:34},113:{x:51,y:108,width:35,height:45,xoffset:1,yoffset:31,xadvance:34},114:{x:93,y:8,width:35,height:42,xoffset:1,yoffset:31,xadvance:35},115:{x:51,y:161,width:35,height:42,xoffset:2,yoffset:31,xadvance:35},116:{x:51,y:211,width:35,height:42,xoffset:1,yoffset:31,xadvance:33},117:{x:52,y:261,width:35,height:42,xoffset:1,yoffset:31,xadvance:34},118:{x:93,y:311,width:34,height:41,xoffset:1,yoffset:31,xadvance:32},119:{x:114,y:360,width:38,height:42,xoffset:1,yoffset:31,xadvance:38},120:{x:140,y:410,width:36,height:41,xoffset:1,yoffset:31,xadvance:37},121:{x:140,y:459,width:35,height:41,xoffset:1,yoffset:31,xadvance:34},122:{x:183,y:459,width:36,height:42,xoffset:2,yoffset:31,xadvance:35},65:{x:94,y:58,width:34,height:53,xoffset:2,yoffset:20,xadvance:36},66:{x:94,y:119,width:35,height:53,xoffset:3,yoffset:20,xadvance:37},67:{x:94,y:180,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},68:{x:95,y:241,width:35,height:53,xoffset:3,yoffset:20,xadvance:37},69:{x:136,y:8,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},70:{x:137,y:69,width:35,height:53,xoffset:2,yoffset:20,xadvance:34},71:{x:179,y:8,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},72:{x:137,y:130,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},73:{x:138,y:191,width:12,height:53,xoffset:2,yoffset:20,xadvance:13},74:{x:138,y:252,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},75:{x:158,y:191,width:35,height:52,xoffset:2,yoffset:20,xadvance:36},76:{x:160,y:313,width:35,height:53,xoffset:2,yoffset:20,xadvance:34},77:{x:181,y:251,width:38,height:53,xoffset:2,yoffset:20,xadvance:39},78:{x:184,y:374,width:35,height:53,xoffset:2,yoffset:20,xadvance:35},79:{x:203,y:312,width:35,height:53,xoffset:2,yoffset:20,xadvance:35},80:{x:180,y:69,width:35,height:53,xoffset:2,yoffset:20,xadvance:34},81:{x:201,y:130,width:35,height:56,xoffset:2,yoffset:20,xadvance:35},82:{x:222,y:8,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},83:{x:223,y:69,width:35,height:53,xoffset:2,yoffset:20,xadvance:35},84:{x:265,y:8,width:35,height:53,xoffset:1,yoffset:20,xadvance:33},85:{x:227,y:194,width:35,height:53,xoffset:2,yoffset:20,xadvance:35},86:{x:244,y:130,width:41,height:52,xoffset:1,yoffset:19,xadvance:39},87:{x:266,y:69,width:38,height:53,xoffset:2,yoffset:20,xadvance:37},88:{x:308,y:8,width:35,height:52,xoffset:1,yoffset:19,xadvance:35},89:{x:227,y:373,width:35,height:52,xoffset:1,yoffset:19,xadvance:34},90:{x:227,y:433,width:35,height:53,xoffset:2,yoffset:20,xadvance:35},33:{x:246,y:255,width:14,height:53,xoffset:0,yoffset:20,xadvance:11},59:{x:180,y:130,width:13,height:37,xoffset:0,yoffset:56,xadvance:13},37:{x:95,y:302,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},58:{x:160,y:374,width:13,height:23,xoffset:0,yoffset:50,xadvance:13},63:{x:268,y:255,width:35,height:53,xoffset:0,yoffset:20,xadvance:33},42:{x:103,y:302,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},40:{x:270,y:190,width:23,height:52,xoffset:0,yoffset:20,xadvance:21},41:{x:293,y:130,width:23,height:52,xoffset:1,yoffset:20,xadvance:21},95:{x:111,y:302,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},43:{x:246,y:316,width:35,height:34,xoffset:0,yoffset:39,xadvance:32},45:{x:184,y:435,width:26,height:11,xoffset:1,yoffset:44,xadvance:25},61:{x:312,y:68,width:35,height:30,xoffset:1,yoffset:42,xadvance:33},46:{x:135,y:313,width:14,height:11,xoffset:0,yoffset:61,xadvance:14},44:{x:227,y:255,width:10,height:21,xoffset:0,yoffset:68,xadvance:11},47:{x:351,y:8,width:28,height:52,xoffset:0,yoffset:19,xadvance:26},124:{x:119,y:302,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},34:{x:127,y:302,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},39:{x:201,y:194,width:18,height:19,xoffset:0,yoffset:0,xadvance:21},64:{x:218,y:435,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},35:{x:218,y:443,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},36:{x:301,y:190,width:32,height:53,xoffset:0,yoffset:22,xadvance:29},94:{x:218,y:451,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},38:{x:246,y:358,width:0,height:0,xoffset:0,yoffset:70,xadvance:22},123:{x:324,y:106,width:27,height:52,xoffset:0,yoffset:20,xadvance:26},125:{x:270,y:358,width:27,height:52,xoffset:2,yoffset:20,xadvance:27},91:{x:270,y:418,width:22,height:53,xoffset:0,yoffset:20,xadvance:21},93:{x:300,y:418,width:22,height:53,xoffset:1,yoffset:20,xadvance:20},48:{x:305,y:316,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},49:{x:311,y:251,width:34,height:53,xoffset:2,yoffset:20,xadvance:35},50:{x:341,y:166,width:35,height:53,xoffset:3,yoffset:20,xadvance:37},51:{x:359,y:68,width:35,height:53,xoffset:3,yoffset:20,xadvance:36},52:{x:330,y:377,width:35,height:53,xoffset:1,yoffset:20,xadvance:35},53:{x:348,y:312,width:35,height:53,xoffset:3,yoffset:20,xadvance:37},54:{x:330,y:438,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},55:{x:353,y:227,width:35,height:53,xoffset:1,yoffset:20,xadvance:34},56:{x:384,y:129,width:35,height:53,xoffset:2,yoffset:20,xadvance:36},57:{x:402,y:8,width:35,height:53,xoffset:3,yoffset:20,xadvance:36},32:{x:0,y:0,width:0,height:0,xoffset:3,yoffset:20,xadvance:22},200:{x:396,y:378,width:40,height:49,xoffset:3,yoffset:21,xadvance:43},201:{x:447,y:313,width:49,height:50,xoffset:3,yoffset:21,xadvance:52},202:{x:399,y:313,width:36,height:53,xoffset:3,yoffset:21,xadvance:39},203:{x:452,y:381,width:39,height:43,xoffset:3,yoffset:21,xadvance:42}}}};
},{}],11:[function(require,module,exports){
var Game, NativeApp, SAVE_TIMER_MS, app, componentToHex, resizeScreen, rgbToHex, screen;

console.log('web startup');

Game = require('./Game');

componentToHex = function(c) {
  var hex;
  hex = Math.floor(c * 255).toString(16);
  if (hex.length === 1) {
    return "0" + hex;
  } else {
    return hex;
  }
};

rgbToHex = function(r, g, b) {
  return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
};

SAVE_TIMER_MS = 3000;

NativeApp = (function() {
  function NativeApp(screen1, width, height) {
    var imageUrl, img, j, len, loadedTextures, ref, state;
    this.screen = screen1;
    this.width = width;
    this.height = height;
    this.tintedTextureCache = [];
    this.lastTime = new Date().getTime();
    this.lastInteractTime = new Date().getTime();
    this.heardOneTouch = false;
    this.touchMouse = null;
    window.addEventListener('mousedown', this.onMouseDown.bind(this), false);
    window.addEventListener('mousemove', this.onMouseMove.bind(this), false);
    window.addEventListener('mouseup', this.onMouseUp.bind(this), false);
    window.addEventListener('touchstart', this.onTouchStart.bind(this), false);
    window.addEventListener('touchmove', this.onTouchMove.bind(this), false);
    window.addEventListener('touchend', this.onTouchEnd.bind(this), false);
    this.context = this.screen.getContext("2d");
    this.textures = ["../images/cards.png", "../images/darkforest.png", "../images/chars.png", "../images/how1.png", "../images/how2.png", "../images/how3.png"];
    this.game = new Game(this, this.width, this.height);
    if (typeof Storage !== "undefined") {
      state = localStorage.getItem("state");
      if (state) {
        this.game.load(state);
      }
    }
    this.pendingImages = 0;
    loadedTextures = [];
    ref = this.textures;
    for (j = 0, len = ref.length; j < len; j++) {
      imageUrl = ref[j];
      this.pendingImages++;
      console.log("loading image " + this.pendingImages + ": " + imageUrl);
      img = new Image();
      img.onload = this.onImageLoaded.bind(this);
      img.src = imageUrl;
      loadedTextures.push(img);
    }
    this.textures = loadedTextures;
    this.saveTimer = SAVE_TIMER_MS;
  }

  NativeApp.prototype.onImageLoaded = function(info) {
    this.pendingImages--;
    if (this.pendingImages === 0) {
      console.log('All images loaded. Beginning render loop.');
      return requestAnimationFrame((function(_this) {
        return function() {
          return _this.update();
        };
      })(this));
    }
  };

  NativeApp.prototype.log = function(s) {
    return console.log("NativeApp.log(): " + s);
  };

  NativeApp.prototype.updateSave = function(dt) {
    var state;
    if (typeof Storage === "undefined") {
      return;
    }
    this.saveTimer -= dt;
    if (this.saveTimer <= 0) {
      this.saveTimer = SAVE_TIMER_MS;
      state = this.game.save();
      return localStorage.setItem("state", state);
    }
  };

  NativeApp.prototype.generateTintImage = function(textureIndex, red, green, blue) {
    var buff, ctx, fillColor, img, imgComp;
    img = this.textures[textureIndex];
    buff = document.createElement("canvas");
    buff.width = img.width;
    buff.height = img.height;
    ctx = buff.getContext("2d");
    ctx.globalCompositeOperation = 'copy';
    ctx.drawImage(img, 0, 0);
    fillColor = "rgb(" + (Math.floor(red * 255)) + ", " + (Math.floor(green * 255)) + ", " + (Math.floor(blue * 255)) + ")";
    ctx.fillStyle = fillColor;
    ctx.globalCompositeOperation = 'multiply';
    ctx.fillRect(0, 0, buff.width, buff.height);
    ctx.globalCompositeOperation = 'copy';
    ctx.globalAlpha = 1.0;
    ctx.globalCompositeOperation = 'destination-in';
    ctx.drawImage(img, 0, 0);
    imgComp = new Image();
    imgComp.src = buff.toDataURL();
    return imgComp;
  };

  NativeApp.prototype.drawImage = function(textureIndex, srcX, srcY, srcW, srcH, dstX, dstY, dstW, dstH, rot, anchorX, anchorY, r, g, b, a) {
    var anchorOffsetX, anchorOffsetY, texture, tintedTexture, tintedTextureKey;
    texture = this.textures[textureIndex];
    if ((r !== 1) || (g !== 1) || (b !== 1)) {
      tintedTextureKey = textureIndex + "-" + r + "-" + g + "-" + b;
      tintedTexture = this.tintedTextureCache[tintedTextureKey];
      if (!tintedTexture) {
        tintedTexture = this.generateTintImage(textureIndex, r, g, b);
        this.tintedTextureCache[tintedTextureKey] = tintedTexture;
      }
      texture = tintedTexture;
    }
    this.context.save();
    this.context.translate(dstX, dstY);
    this.context.rotate(rot);
    anchorOffsetX = -1 * anchorX * dstW;
    anchorOffsetY = -1 * anchorY * dstH;
    this.context.translate(anchorOffsetX, anchorOffsetY);
    this.context.globalAlpha = a;
    this.context.drawImage(texture, srcX, srcY, srcW, srcH, 0, 0, dstW, dstH);
    return this.context.restore();
  };

  NativeApp.prototype.update = function() {
    var drawCall, dt, fpsInterval, goalFPS, i, n, now, renderCommands, timeSinceInteract;
    requestAnimationFrame((function(_this) {
      return function() {
        return _this.update();
      };
    })(this));
    now = new Date().getTime();
    dt = now - this.lastTime;
    timeSinceInteract = now - this.lastInteractTime;
    if (timeSinceInteract > 5000) {
      goalFPS = 5;
    } else {
      goalFPS = null;
    }
    if (this.lastGoalFPS !== goalFPS) {
      console.log("switching to " + goalFPS + " FPS");
      this.lastGoalFPS = goalFPS;
    }
    if (goalFPS !== null) {
      fpsInterval = 1000 / goalFPS;
      if (dt < fpsInterval) {
        return;
      }
    }
    this.lastTime = now;
    this.context.clearRect(0, 0, this.width, this.height);
    if (this.game.update(dt)) {
      this.lastInteractTime = now;
    }
    renderCommands = this.game.render();
    i = 0;
    n = renderCommands.length;
    while (i < n) {
      drawCall = renderCommands.slice(i, i += 16);
      this.drawImage.apply(this, drawCall);
    }
    return this.updateSave(dt);
  };

  NativeApp.prototype.onTouchStart = function(evt) {
    var j, len, results, touch, touches;
    this.lastInteractTime = new Date().getTime();
    this.heardOneTouch = true;
    touches = evt.changedTouches;
    results = [];
    for (j = 0, len = touches.length; j < len; j++) {
      touch = touches[j];
      if (this.touchMouse === null) {
        this.touchMouse = touch.identifier;
      }
      if (this.touchMouse === touch.identifier) {
        results.push(this.game.touchDown(touch.clientX, touch.clientY));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  NativeApp.prototype.onTouchMove = function(evt) {
    var j, len, results, touch, touches;
    this.lastInteractTime = new Date().getTime();
    touches = evt.changedTouches;
    results = [];
    for (j = 0, len = touches.length; j < len; j++) {
      touch = touches[j];
      if (this.touchMouse === touch.identifier) {
        results.push(this.game.touchMove(touch.clientX, touch.clientY));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  NativeApp.prototype.onTouchEnd = function(evt) {
    var j, len, touch, touches;
    this.lastInteractTime = new Date().getTime();
    touches = evt.changedTouches;
    for (j = 0, len = touches.length; j < len; j++) {
      touch = touches[j];
      if (this.touchMouse === touch.identifier) {
        this.game.touchUp(touch.clientX, touch.clientY);
        this.touchMouse = null;
      }
    }
    if (evt.touches.length === 0) {
      return this.touchMouse = null;
    }
  };

  NativeApp.prototype.onMouseDown = function(evt) {
    if (this.heardOneTouch) {
      return;
    }
    this.lastInteractTime = new Date().getTime();
    return this.game.touchDown(evt.clientX, evt.clientY);
  };

  NativeApp.prototype.onMouseMove = function(evt) {
    if (this.heardOneTouch) {
      return;
    }
    this.lastInteractTime = new Date().getTime();
    return this.game.touchMove(evt.clientX, evt.clientY);
  };

  NativeApp.prototype.onMouseUp = function(evt) {
    if (this.heardOneTouch) {
      return;
    }
    this.lastInteractTime = new Date().getTime();
    return this.game.touchUp(evt.clientX, evt.clientY);
  };

  return NativeApp;

})();

screen = document.getElementById('screen');

resizeScreen = function() {
  var currentAspectRatio, desiredAspectRatio;
  desiredAspectRatio = 16 / 9;
  currentAspectRatio = window.innerWidth / window.innerHeight;
  if (currentAspectRatio < desiredAspectRatio) {
    screen.width = window.innerWidth;
    return screen.height = Math.floor(window.innerWidth * (1 / desiredAspectRatio));
  } else {
    screen.width = Math.floor(window.innerHeight * desiredAspectRatio);
    return screen.height = window.innerHeight;
  }
};

resizeScreen();

app = new NativeApp(screen, screen.width, screen.height);


},{"./Game":4}]},{},[11]);
